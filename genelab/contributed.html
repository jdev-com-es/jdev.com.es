<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jDev GeneLab</title>

    <meta name="author" content="JanCraft">
    <meta name="description" content="jDev GeneLab - Human External Gene Aggregation Database and Laboratory">
    
    <link rel="shortcut icon" href="/img/favicon.png" type="image/png">
    <style>
        html, body {
            font-family: sans-serif;
            background: #333;
            color: #fff;
        }
    </style>
</head>
<body>
    <h1>Thanks for contributing!</h1>
    <h4>Redirecting to main website...</h4>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js";
        import { getFirestore, setDoc, doc } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-firestore.js";
        const params = new URLSearchParams(location.search);

        const firebaseConfig = {
            apiKey: "AIzaSyBUAk_ApThWMffxak1sYr9hPowFM4MY7zc",
            authDomain: "jdev-genelab-hegadl.firebaseapp.com",
            projectId: "jdev-genelab-hegadl",
            storageBucket: "jdev-genelab-hegadl.appspot.com",
            messagingSenderId: "424059033160",
            appId: "1:424059033160:web:511a667551feb72f466a7d"
        };

        function prep(str) {
            return str.trim().split(' ').map(x => x[0] + "*".repeat(x.substr(1).length)).join(' ');
        }

        const app = initializeApp(firebaseConfig);
        const db = getFirestore();

        try {
            const docRef = await setDoc(doc(db, "aggregation", params.get('subjectid')), {
                age: parseInt(params.get('age')),
                height: parseInt(params.get('height')),
                biogender: params.get('biogender'),
                country: params.get('country'),
                subjectid: parseInt(params.get('subjectid')),
                facial: params.get('facial'),
                fullname: prep(params.get('fullname'))
            });
            console.log("Document written: ", docRef);
            setTimeout(() => location.href = "/genelab/", 2000);
        } catch (e) {
            console.error("Error adding document: ", e);
        }
    </script>
</body>
</html>