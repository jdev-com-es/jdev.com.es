<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jDev GeneLab - HEGADL</title>

    <meta name="author" content="JanCraft">
    <meta name="description" content="jDev GeneLab - Human External Gene Aggregation Database and Laboratory">
    
    <link rel="shortcut icon" href="/img/favicon.png" type="image/png">
    <style>
        html, body {
            font-family: sans-serif;
            background: #333;
            color: #fff;
            margin: 0;
        }

        h2 {
            background-color: #046DAA;
            margin: 0;
            padding: 1rem;
        }
        #subjectid, #content {
            margin: 1rem;
        }
    </style>
</head>
<body>
    <h2>GeneLab HEGADL Inspector</h2>
    <h4 id="subjectid"></h4>

    <div id="content"></div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js";
        import { getFirestore, collection, getDoc, doc } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-firestore.js";
        const params = new URLSearchParams(location.search);

        const biogenders = {
            'm': 'Macho',
            'f': 'Hembra',
            'i': 'Intersexual'
        }

        function keytoname(key) {
            return {
                N: "Marrón",
                B: "Azul",
                H: "Avellana",
                G: "Gris",
                E: "Verde",
                A: "Ámbar",
                K: "Negro",
                W: "Marrón Profundo",
                U: "Marrón-Rojizo",
                R: "Rojo",
                L: "Rubio",
                Y: "Amarillo Profundo",
                F: "Amarillo",
                T: "Claro",
                I: "Blanco / Pálido",
                '?': "N/A",
                "/": "Liso",
                "~": "Ondulado",
                "&": "Rizado",
                "#": "Afro-texturizado",
                "0": "Ovalado",
                O: "Redondo",
                "@": "Cuadrado",
                "<": "Rombo",
                "^": "Punta hacia Arriba",
                "_": "Punta hacia Abajo",
                X: "No",
                "-": "Pocas",
                "+": "Muchas"
            }[key];
        }

        function cap(s) {
            return s[0].toUpperCase() + s.substr(1);
        }

        const eye_rarity = {
            N: .8,
            B: .1,
            H: .05,
            G: .03,
            E: .02,
            A: .001
        };

        const hair_rarity = {
            K: .9,
            W: .8,
            N: .11,
            U: .02,
            R: .01,
            L: .03,
            G: .25
        };

        const skin_rarity = {
            W: .024,
            N: .213,
            Y: .274,
            F: .293,
            T: .196,
            I: .196
        };

        const firebaseConfig = {
            apiKey: "AIzaSyBUAk_ApThWMffxak1sYr9hPowFM4MY7zc",
            authDomain: "jdev-genelab-hegadl.firebaseapp.com",
            projectId: "jdev-genelab-hegadl",
            storageBucket: "jdev-genelab-hegadl.appspot.com",
            messagingSenderId: "424059033160",
            appId: "1:424059033160:web:511a667551feb72f466a7d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore();

        document.getElementById('subjectid').innerHTML = `Subject #${params.get('id')}<br>Loading...`;

        const docRef = doc(db, 'aggregation', params.get('id'));
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
            const data = docSnap.data();

            const rarity = eye_rarity[data.facial[0]] * hair_rarity[data.facial[1]] * skin_rarity[data.facial[2]] * ((data.facial[5] == '-' || data.facial[5] == '+') ? .16 : 1);

            document.getElementById('subjectid').innerHTML = `Sujeto #${params.get('id')}<br>${data.fullname}`;
            document.getElementById('content').innerHTML = `
                <div><b>Género Biológico</b> <i>${biogenders[data.biogender]}</i></div>
                <div><b>Edad</b> <i>${data.age}</i></div>
                <div><b>País</b> <i>${data.country}</i></div>
                <div><b>Altura</b> <i>${data.height} cm</i></div>
                <div><b>Clasificador facial</b> <i>${data.facial}</i></div>
                <br>
                <div><b>Color de Ojos</b> <i>${cap(keytoname(data.facial[0]))}</i></div>
                <div><b>Color de Pelo</b> <i>${cap(keytoname(data.facial[1]))}</i></div>
                <div><b>Color de Piel</b> <i>${cap(keytoname(data.facial[2]))}</i></div>

                <div><b>Forma de la Cara</b> <i>${cap(keytoname(data.facial[3]))}</i></div>
                <div><b>Forma de los Ojos</b> <i>${cap(keytoname(data.facial[4]))}</i></div>
                <div><b>Pecas</b> <i>${cap(keytoname(data.facial[5]))}</i></div>
                <br>
                <div><b>Rareza de Rasgos</b> <i>${(rarity * 100).toFixed(2)}%</i></div>
            `;

            console.log(data);
        } else {
            window.close();
        }
    </script>
</body>
</html>